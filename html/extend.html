
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      --><title>extend</title><meta name="generator" content="MATLAB 7.10"><meta name="date" content="2013-11-26"><meta name="m-file" content="extend"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#3">parse and resample sensor data</a></li><li><a href="#4">Compute squares, magnitude, un bias</a></li><li><a href="#5">Build filters</a></li><li><a href="#6">Populate struct array</a></li><li><a href="#7">Plot</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> extend (filename)
</pre><pre class="codeinput"><span class="keyword">if</span> (nargin == 0)
	filename = <span class="string">'data/walking_from_cc_11_11.txt'</span>;
<span class="keyword">end</span>

close <span class="string">all</span>;
</pre><h2>parse and resample sensor data<a name="3"></a></h2><pre class="codeinput">androidAPP(filename);
load <span class="string">data.mat</span>;
n = 1:accData(1, end);
extended = zeros(3,length(n));
count = 0;
<span class="keyword">for</span> i = 1:length(accData)
    <span class="keyword">while</span> (accData(1,i) &gt; count)
        count = count + 1;
        extended(1,count) =  accData(2,i);
        extended(2,count) =  accData(3,i);
        extended(3,count) =  accData(4,i);
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><pre class="codeoutput">writing file.....
</pre><h2>Compute squares, magnitude, un bias<a name="4"></a></h2><pre class="codeinput">x2 = extended(1,1:10000).^2;
y2 = extended(2,1:10000).^2;
z2 = extended(3,1:10000).^2;

mag = sqrt(x2+y2+z2);
norm_mag = mag - mean(mag);
</pre><h2>Build filters<a name="5"></a></h2><pre class="codeinput"><span class="comment">% Equiripple Lowpass filter designed using the FIRPM function.</span>
<span class="comment">% All frequency values are in Hz.</span>
<span class="comment">% Fs = 1000;  % Sampling Frequency</span>

<span class="comment">% Fpass = 1;               % Passband Frequency</span>
<span class="comment">% Fstop = 140;             % Stopband Frequency</span>
<span class="comment">% Dpass = 0.057501127785;  % Passband Ripple</span>
<span class="comment">% Dstop = 0.0001;          % Stopband Attenuation</span>
<span class="comment">% dens  = 20;              % Density Factor</span>
d140 = drop140();



<span class="comment">% IIR maximally flat Lowpass filter designed using the MAXFLAT function.</span>
<span class="comment">% All frequency values are in Hz.</span>
<span class="comment">% Fs = 1000;  % Sampling Frequency</span>

<span class="comment">% Nb = 8;   % Numerator Order</span>
<span class="comment">% Na = 8;   % Denominator Order</span>
<span class="comment">% Fc = 20;  % Cutoff Frequency</span>
d20  = drop20();
</pre><h2>Populate struct array<a name="6"></a></h2><pre class="codeinput">pStruct(1).x 	= extended(1,1:10000);
pStruct(1).y 	= extended(2,1:10000);
pStruct(1).z 	= extended(3,1:10000);
pStruct(1).mag	= mag;


pStruct(2).x	= filter( d140, pStruct( 1 ).x   );
pStruct(2).y	= filter( d140, pStruct( 1 ).y   );
pStruct(2).z	= filter( d140, pStruct( 1 ).z   );
pStruct(2).mag 	= filter( d140, norm_mag         );
pStruct(3).x	= filter( d20 , pStruct( 1 ).x   );
pStruct(3).y	= filter( d20 , pStruct( 1 ).y   );
pStruct(3).z	= filter( d20 , pStruct( 1 ).z   );
pStruct(3).mag 	= filter( d20 , norm_mag         );
<span class="comment">% pStruct(4).x	= stdf  ( d140, pStruct( 1 ).x, 360);</span>
<span class="comment">% pStruct(4).y	= stdf  ( d140, pStruct( 1 ).y, 360);</span>
<span class="comment">% pStruct(4).z	= stdf  ( d140, pStruct( 1 ).z, 360);</span>
<span class="comment">% pStruct(4).mag	= stdf  ( d140, pStruct( 1 ).mag, 360);</span>
<span class="comment">% pStruct(5).x	= stdf  ( d20 , pStruct( 1 ).x, 360);</span>
<span class="comment">% pStruct(5).y	= stdf  ( d20 , pStruct( 1 ).y, 360);</span>
<span class="comment">% pStruct(5).z	= stdf  ( d20 , pStruct( 1 ).z, 360);</span>
<span class="comment">% pStruct(5).mag	= stdf  ( d20 , pStruct( 1 ).mag, 360);</span>
</pre><h2>Plot<a name="7"></a></h2><pre class="codeinput">plotStruct(pStruct,3);


<span class="comment">% Mag = fftshift(fft(filtered));</span>

<span class="comment">% spectrogram(filtered, 8);</span>


<span class="comment">%</span>
<span class="comment">% midpt = ceil(length(Mag)/2);</span>
<span class="comment">% window_width = 1000;</span>
<span class="comment">% viewing_window = midpt-window_width:midpt+window_width;</span>
<span class="comment">%</span>
<span class="comment">% plotStruct(pStruct,depth);</span>
<span class="comment">%</span>
<span class="comment">%</span>
<span class="comment">% stem(abs(Mag(viewing_window)));</span>
<span class="comment">%</span>
</pre><img vspace="5" hspace="5" src="extend_01.png" alt=""> <img vspace="5" hspace="5" src="extend_02.png" alt=""> <img vspace="5" hspace="5" src="extend_03.png" alt=""> <pre class="codeoutput">Input argument "depth" is undefined.

Error in ==&gt; plotStruct at 3
for i = 1:depth
</pre><pre class="codeinput"><span class="keyword">end</span>
<span class="comment">% title ('frequency breakdown');</span>
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.10<br></p></div><!--
##### SOURCE BEGIN #####
function extend (filename)

if (nargin == 0)
	filename = 'data/walking_from_cc_11_11.txt';
end

close all;

%% parse and resample sensor data
androidAPP(filename);
load data.mat;
n = 1:accData(1, end); 
extended = zeros(3,length(n));
count = 0;
for i = 1:length(accData)
    while (accData(1,i) > count)
        count = count + 1;
        extended(1,count) =  accData(2,i);
        extended(2,count) =  accData(3,i);
        extended(3,count) =  accData(4,i);  
    end
end

%% Compute squares, magnitude, un bias 
x2 = extended(1,1:10000).^2;
y2 = extended(2,1:10000).^2;
z2 = extended(3,1:10000).^2;

mag = sqrt(x2+y2+z2);
norm_mag = mag - mean(mag);

%% Build filters

% Equiripple Lowpass filter designed using the FIRPM function.
% All frequency values are in Hz.
% Fs = 1000;  % Sampling Frequency

% Fpass = 1;               % Passband Frequency
% Fstop = 140;             % Stopband Frequency
% Dpass = 0.057501127785;  % Passband Ripple
% Dstop = 0.0001;          % Stopband Attenuation
% dens  = 20;              % Density Factor
d140 = drop140();



% IIR maximally flat Lowpass filter designed using the MAXFLAT function.
% All frequency values are in Hz.
% Fs = 1000;  % Sampling Frequency

% Nb = 8;   % Numerator Order
% Na = 8;   % Denominator Order
% Fc = 20;  % Cutoff Frequency
d20  = drop20();


%% Populate struct array
pStruct(1).x 	= extended(1,1:10000);
pStruct(1).y 	= extended(2,1:10000);
pStruct(1).z 	= extended(3,1:10000);
pStruct(1).mag	= mag;


pStruct(2).x	= filter( d140, pStruct( 1 ).x   );
pStruct(2).y	= filter( d140, pStruct( 1 ).y   );
pStruct(2).z	= filter( d140, pStruct( 1 ).z   );
pStruct(2).mag 	= filter( d140, norm_mag         );
pStruct(3).x	= filter( d20 , pStruct( 1 ).x   );
pStruct(3).y	= filter( d20 , pStruct( 1 ).y   );
pStruct(3).z	= filter( d20 , pStruct( 1 ).z   );
pStruct(3).mag 	= filter( d20 , norm_mag         );
% pStruct(4).x	= stdf  ( d140, pStruct( 1 ).x, 360);
% pStruct(4).y	= stdf  ( d140, pStruct( 1 ).y, 360);
% pStruct(4).z	= stdf  ( d140, pStruct( 1 ).z, 360);
% pStruct(4).mag	= stdf  ( d140, pStruct( 1 ).mag, 360);
% pStruct(5).x	= stdf  ( d20 , pStruct( 1 ).x, 360);
% pStruct(5).y	= stdf  ( d20 , pStruct( 1 ).y, 360);
% pStruct(5).z	= stdf  ( d20 , pStruct( 1 ).z, 360);
% pStruct(5).mag	= stdf  ( d20 , pStruct( 1 ).mag, 360);




%% Plot
plotStruct(pStruct,3);


% Mag = fftshift(fft(filtered));

% spectrogram(filtered, 8);

		
% 
% midpt = ceil(length(Mag)/2);
% window_width = 1000;
% viewing_window = midpt-window_width:midpt+window_width;
% 
% plotStruct(pStruct,depth);
% 
% 
% stem(abs(Mag(viewing_window)));
% 

end
% title ('frequency breakdown');
##### SOURCE END #####
--></body></html>